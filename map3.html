<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Map interactive — fenêtres de contenu</title>
<style>
  :root{
    --ui-bg: rgba(0,0,0,0.6);
    --ui-color: #fff;
    --player-size: 50px;
    --marker-size: 80px;
  }
  html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;}
  #app{height:100vh;display:flex;flex-direction:column;}
  #hud{
    position:fixed; left:10px; top:10px; z-index:30;
    background:var(--ui-bg); color:var(--ui-color); padding:8px 12px;border-radius:8px;
    font-size:14px; box-shadow:0 4px 12px rgba(0,0,0,.4);
    user-select:none;
  }
  #hud b{display:inline-block; min-width:80px;}
  #viewport{
    position:relative; flex:1; overflow:hidden; background:#222;
  }
  #map{
    position:absolute; left:0; top:0;
    transform-origin:0 0;
  }
  #player{
    position:absolute;
    width:var(--player-size); height:var(--player-size);
    margin-left: calc(var(--player-size) / -2);
    margin-top: calc(var(--player-size) / -2);
    z-index:40;
    cursor:grab;
    transition: transform .03s linear;
  }
  #player:active{cursor:grabbing;}
  .marker{
    position:absolute;
    width:var(--marker-size); height:var(--marker-size);
    margin-left: calc(var(--marker-size) / -2);
    margin-top: calc(var(--marker-size) / -2);
    z-index:35;
    pointer-events:auto;
    user-select:none;
  }
  /* ==================== MODALE ==================== */
  #modal{
    display:none; position:fixed; inset:0; z-index:100; 
    background: rgba(0,0,0,.7);
    align-items:center; justify-content:center;
    padding:20px;
  }
  #modalContent{
    background:#fff; color:#000;
    max-width:600px; max-height:80vh;
    overflow-y:auto;
    border-radius:10px;
    padding:20px;
    box-shadow:0 10px 40px rgba(0,0,0,.5);
    text-align:center;
  }
  #modalContent img{
    max-width:100%;
    height:auto;
    border-radius:8px;
    margin-bottom:12px;
  }
  #closeBtn{
    background:#222; color:#fff;
    border:none;
    padding:8px 16px;
    border-radius:6px;
    cursor:pointer;
    margin-top:10px;
  }
  #tips{
    position:fixed; right:10px; top:10px; z-index:30;
    background:var(--ui-bg); color:var(--ui-color); padding:8px 12px;border-radius:8px;
    font-size:13px; max-width:220px;
  }
  @media (max-width:600px){
    #hud {font-size:12px}
    :root{--player-size:28px; --marker-size:28px;}
  }
</style>
</head>
<body>
<div id="app">
  <div id="hud">
    <div><b>Position</b> <span id="pos">x:0, y:0</span></div>
    <div style="margin-top:6px"><b>Map</b> <span id="mapName"></span></div>
    <div style="margin-top:6px"><b>Lieu</b> <span id="locLabel"></span></div>
  </div>

  <div id="viewport">
    <div id="map">
      <img id="player" src="data:image/svg+xml;utf8,
        <svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 24 24' fill='none' stroke='%23ffcc00' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'><circle cx='12' cy='10' r='3.2' /><path d='M12 2v3M12 21v-3M20 12h-3M7 12H4M17.5 6.5L15.5 8.5M8.5 15.5L6.5 17.5M17.5 17.5L15.5 15.5M8.5 8.5L6.5 6.5' /></svg>" alt="player" draggable="false">
    </div>
  </div>

  <!-- Fenêtre modale -->
  <div id="modal">
    <div id="modalContent">
      <img id="modalImg" src="" alt="">
      <div id="modalText"></div>
      <button id="closeBtn" onclick="hideModal()">Fermer</button>
    </div>
  </div>
</div>

<script>
/* ==========================
   CONFIGURATION
   ========================== */
const MAPS = {
  "ville-centre": {
    id: "ville-centre",
    name: "Ville - Centre",
    bg: "Philo/Vert.png",
    width: 1300,
    height: 600
  }
};

// Map de départ
let CURRENT_MAP_ID = "ville-centre";

/* Exemple : chaque lieu peut maintenant avoir :
   - type: 'info' → ouvrira une fenêtre dans la page
   - img: image à afficher
   - text: texte avec \n ou \n\n
*/
let LOCATIONS = [
  { x: 200, y: 200, img: "Philo/Bonheur.png", type: "info", 
    label:"Bonheur",
    contentImg:"Philo/Bonheur2.png",
    contentText:"HIERARCHIE DU BONHEUR\n Plaisir → lié au corps, instantané, mode de consommation.\n Joie → liée à la création, durée, émotion active.\n Bonheur → état existentiel de l’être, temporalité : la vie.\n Béatitude → liée à l’âme et à Dieu, transcendance, éternité.\n Dans cette échelle, le plaisir est jugé inférieur (corporel) et la béatitude supérieure (divine). Le bonheur occupe une place intermédiaire, terrestre.\n Platon : le plaisir est mêlé à la douleur → impur, alors que le bonheur doit être sans mélange. Sénèque : le plaisir existe aussi chez les fous et les méchants → il ne peut définir le bonheur.\n \n Calliclès soutient que le vrai bonheur consiste à laisser libre cours à ses passions, aussi grandes soient-elles, et à les assouvir grâce au courage et à l’intelligence. Selon lui, la masse, incapable d’une telle intensité de vie, érige artificiellement la tempérance et la justice en vertus, par faiblesse. Socrate, en réponse, illustre deux styles de vie par une métaphore des tonneaux : l’homme tempérant, dont les tonneaux sont pleins, vit dans la tranquillité, tandis que l’homme insatiable, aux tonneaux percés, doit remplir sans cesse et souffre de son manque. Il montre ainsi que la tempérance assure paix et stabilité.\n \n  Mieux vaut être Socrate insatisfait qu’un imbécile satisfait (J.S. Mill) Cette phrase est centrale dans la philosophie utilitariste de John Stuart Mill, qui voulait distinguer les plaisirs inférieurs (corporels, immédiats, communs aux animaux) et les plaisirs supérieurs (intellectuels, spirituels, esthétiques). Le paradoxe : Socrate, en tant que philosophe, est capable de rechercher la vérité, de comprendre, de juger et de réfléchir. Mais cette quête entraîne souvent de l’insatisfaction : le savoir fait prendre conscience des limites de la vie, de la souffrance, de l’injustice. À l’inverse,  l’imbécile satisfait  vit dans une jouissance simple, sans se poser de questions, mais cette satisfaction est jugée inférieure en qualité.\n \n \n \n \n BONHEUR COMME CORRESONDANCE AU MONDE OU ACTIVITE ?\n Les grandes philosophies antiques ont défini le bonheur comme indépendance intérieure. Les biens matériels peuvent contribuer au confort, mais ils ne garantissent pas le bonheur : ils rendent souvent dépendants, comme le rappelle Sénèque en distinguant celui qui possède ses richesses de celui qui est possédé par elles. Le bonheur n’est donc pas  avoir plus , mais  être autrement, c’est-à-dire développer une aptitude à se réjouir de ce que l’on a et à vivre en harmonie avec le monde. Les Stoïciens insistaient sur l’accord avec l’ordre du cosmos, Aristote sur l’accomplissement de la nature humaine, et Épicure sur la juste mesure des désirs.  Le bonheur n’est donc pas un plaisir passager, mais une activité vertueuse qui se construit tout au long de la vie, par l’éducation, l’effort et la pratique du bien. En d’autres termes, pour Aristote, on est heureux non pas quand on a beaucoup, mais quand on devient pleinement ce que l’on est : un être raisonnable et juste. Ainsi, vivre en accord avec la raison, c’est orienter sa vie non pas selon les pulsions, les désirs immédiats ou les émotions, mais selon un jugement réfléchi sur ce qui est juste et bon. Cela suppose de trouver la mesure dans nos actions — par exemple, ni trop de peur ni trop d’audace, mais le juste courage. C’est ce qu’Aristote appelle la vertu : le juste milieu entre deux excès. Tous s’accordent sur l idée que l’homme heureux est celui qui transforme son rapport au monde plutôt que d’accumuler des biens. Le bonheur devient ainsi un mode d’être, une manière d’habiter le monde dans l’acceptation de ce qui dépend de nous et dans la sérénité face à ce qui échappe à notre maîtrise.\n \n Le bonheur a été pensé dès l’Antiquité comme la fin suprême de l’existence, à la fois objet universel de désir et principe de la morale (eudémonisme). Dans l’Éthique à Nicomaque, Aristote définit le bonheur comme le bien suprême, fin ultime de l’existence humaine. Il réside dans l’exercice vertueux de la raison, selon la vertu (aretè), et dans l’accomplissement de la nature rationnelle de l’homme. Il n’est pas état passif mais activité en acte. L’intérêt est d’unir bonheur et vertu, en fondant la joie de vivre sur la pleine actualisation des capacités humaines, dans une vie cohérente et réfléchie.\n \n Épicure – Le bonheur est l’ataraxie, absence de trouble de l’âme. Pour Épicure, le bonheur ne réside ni dans les plaisirs excessifs ni dans les honneurs, mais dans un état d’équilibre : l’absence de douleur corporelle (aponie) et l’absence de trouble dans l’âme (ataraxie). Par le calcul rationnel des plaisirs, on élimine les désirs vains, la peur des dieux et de la mort. Le bonheur devient une vie simple, stable, entourée d’amitié et de réflexion.\n L’intérêt est de montrer que le bonheur véritable est accessible à tous, fondé sur la modération et la lucidité plutôt que sur la richesse ou la passion.\n \n Pour Zhuangzi le riche s’épuise sans profiter, le dignitaire vit dans l’angoisse, et la vie, même longue, n’apporte que soucis. Le véritable bonheur ne réside pas dans ces poursuites illusoires mais dans le « non-agir » (wu wei), que la foule méprise. Comme le ciel et la terre, inactifs mais féconds, l’homme devrait apprendre à s’accorder à ce principe : ne pas agir, c’est laisser advenir l’harmonie et préserver l’existence. Ainsi, la joie suprême n’est pas accumulation mais détachement, transparence et stabilité, sources de fécondité véritable.\n \n Nietzsche est en rupture avec la sagesse ancienne. Il rompt avec l’idéal classique du bonheur comme équilibre, harmonie, unité. Pour lui, le bonheur n’est pas un repos, mais un mouvement vital : « Le bonheur est le sentiment que la puissance croît, que l’on surmonte une résistance. »  Le bonheur n’est pas le contentement passif (ataraxie stoïcienne, béatitude chrétienne), mais une affirmation active de la vie, même dans la lutte et la souffrance. Ainsi, Nietzsche substitue au paradigme de l’unité une conception dynamique, agonistique du bonheur. Le grand style de vie consiste à dire oui à l’existence telle qu’elle est, par l’épreuve de l’éternel retour et la volonté de puissance. \n \n Spinoza fait du bonheur non pas un état passager ou un simple sentiment agréable, mais l’expression de la liberté qui se conquiert à travers la connaissance. En comprenant les causes qui déterminent nos affects et nos actions, nous cessons d’être ballottés par les passions et nous devenons actifs, c’est-à-dire auteurs de notre vie. Le bonheur n’est donc pas donné de l’extérieur, mais il résulte d’un travail intérieur de compréhension rationnelle du réel, qui culmine dans ce que Spinoza appelle « l’amour intellectuel de Dieu ». Cela signifie que le bonheur consiste dans la joie d’accepter la nécessité de la nature telle qu’elle est, sans illusions ni révolte, mais en reconnaissant la cohérence et la beauté de l’ordre universel. Ainsi, être heureux n’est pas refuser le réel ni vouloir qu’il soit autre qu’il est, mais en saisir la nécessité et s’y accorder pleinement : c’est en ce sens que Spinoza fait du bonheur une conquête de la sagesse. \n \n Pour Bergson (dans l'énergie spirituelle), l’effort est plus précieux que l’œuvre, car il permet de se dépasser. La matière, en opposant résistance et en se laissant transformer, devient à la fois obstacle, instrument et stimulant. La vraie joie n’est pas dans l’argent, la gloire ou les honneurs, mais dans le sentiment créateur : faire naître quelque chose qui n’existait pas. L’artiste ou le savant trouvent leur joie dans l’accomplissement de leur pensée, non dans l’admiration reçue. Ainsi, la finalité de la vie humaine réside dans la création de soi par soi, dans l’agrandissement intérieur par l’effort, source authentique de joie et de richesse.\n \n \n \n \n ILLUSION DU BONHEUR\n Pour Kant, le bonheur n’est pas un concept clair et rationnel, mais un idéal indéterminé. Pourquoi ? Le bonheur est défini comme « l’état de complète satisfaction de nos désirs », mais nos désirs sont multiples, changeants, contradictoires. Ce qui rend heureux l’un peut rendre malheureux l’autre (richesse, santé, gloire, amour…). Même pour une seule personne, la conception du bonheur change avec les circonstances : le malade veut la santé, le pauvre veut la richesse, etc. La contradiction interne : Tout bien recherché pour le bonheur peut aussi avoir un revers (la richesse entraîne des soucis, la gloire apporte des ennemis, l’amour apporte de la souffrance). Donc le bonheur est insaisissable comme objet déterminé. Conséquence morale : Si le bonheur est indéterminé, il ne peut pas servir de fondement à la morale. La morale, pour Kant, doit être fondée non sur la recherche du bonheur (subjectif, empirique, incertain), mais sur le devoir et la raison (loi morale universelle). D’où sa formule : « le bonheur est un idéal non de la raison, mais de l’imagination ». On peut donner des conseils pratiques pour être heureux (prudence), mais pas des préceptes universels (comme on le fait pour la morale).\n \n Schopenhauer – Le bonheur est illusion, la vie est souffrance. Dans Le Monde comme volonté et comme représentation, Schopenhauer affirme que la vie est fondamentalement souffrance, car gouvernée par la Volonté, force aveugle et insatiable. Le bonheur n’est qu’un bref soulagement entre deux manques. La sagesse consiste à se détacher du vouloir, par l’art, la morale, la compassion ou l’ascèse. L’intérêt est de désillusionner la quête du bonheur, pour lui substituer une lucidité tragique et une voie de libération intérieure.\n \n Si l’on vous proposait de vous injecter dans le cerveau une drogue vous procurant un sentiment de plaisir permanent, pendant toute votre vie (quand votre corps deviendra trop vieux, on vous euthanasie, sans souffrance), accepteriez-vous ? Selon Robert Spaemann, le philosophe ayant imaginé cette expérience, nous refuserions. Pourquoi ? Il fait remarquer qu'à la question que voulons-nous au fond ?, la réponse  est : « Nous voulons en effet la réalité. Nous ne voulons pas, si toutefois nous ne sommes ni malades, ni dépendants, une euphorie illusoire, mais un bonheur qui repose sur un contact avec la réalité effective. » Le bonheur ne se confond donc pas avec le plaisir. L'homme désire la joie, laquelle est liée à une activité ayant du sens, c'est-à-dire altruiste.\n \n \n \n \n SOCIETE VS INDIVIDU\n Avec le temps, la réflexion sur le bonheur s’est politisée et socialisée. Le droit au bonheur des Lumières, l’utilitarisme de Bentham et Mill traduis la tentative de mesurer et d’organiser le bien-être collectif, en faisant du bonheur un objectif social et matériel. Mais cette approche révèle ses limites : le bonheur ne dépend pas de conditions extérieures, il est un état subjectif et non un produit ou un événement. L’insatisfaction, le désir croissant et la compétition sociale rendent le bonheur de plus en plus rare et fragile, et sa recherche peut paradoxalement provoquer du malheur.\n \n Pour Mill le bonheur est à penser comme la maximisation du plaisir pour le plus grand nombre.\n Mill, dans L’Utilitarisme, il affirme que le bonheur est le seul critère moral légitime. Il le définit comme plaisir durable, enrichi de qualités intellectuelles, morales et affectives. Le bonheur individuel compte, mais doit être pondéré par l’utilité sociale. L’éducation et la culture permettent d’élever les individus vers des plaisirs supérieurs.\n L’intérêt est de fonder une éthique rationnelle, sociale et démocratique du bonheur, dépassant le pur hédonisme pour viser le bien commun.",
  },
  { x: 400, y: 400, img: "Philo/Conscience.png", type: "info", 
    label:"Conscience",
    contentImg:"Philo/Conscience2.png",
    contentText:"L'HOMME FACE A LUI MEME\nL’humanité a longtemps cru que toute la nature était animée par une conscience : des plantes aux étoiles, tout semblait habité. Avec la science et la technique, cette vision s’est effacée. L’homme a d’abord expulsé le divin de la nature, puis de son propre esprit, jusqu’à se retrouver seul face à sa conscience. Mais ce qu’il croyait être une transparence immédiate s’est révélé bien plus complexe et problématique.\nLa conscience est avant tout une présence à soi, une expérience immédiate. Elle ne requiert pas la réflexion : lorsqu’on a mal, on le sait sans raisonnement. C’est un rapport intérieur entre soi et ses représentations. Une représentation (souvenir, idée, rêve) est consciente lorsqu’elle est perçue comme telle. Le mot vient du latin cum (avec) et scire (savoir) : savoir avec soi-même. Locke en donne une définition claire : la conscience est la perception des événements de l’esprit. Elle n’est donc pas une substance, mais une modalité de l’activité psychique.\nJe connais mieux mes pensées ou mes émotions que les processus physiologiques de mon corps. Descartes en fit le fondement de la certitude philosophique. La conscience a cette spécificité d’être réflexive : elle peut se prendre elle-même pour objet. Lorsque je pense, je pense que je pense. Cela introduit une scission intérieure : le je (source d’activité) se distingue du moi (image ou forme qu’il prend). Ainsi, je peux me révolter à la fois contre le monde et contre le moi passif que j’étais. La conscience est toujours relation, mais relation qui suppose un écart entre soi et soi.\nDepuis l’âge classique, la question de l’évolution de la conscience oppose deux conceptions philosophiques majeures. Pour Spinoza, la conscience n’apparaît pas de façon graduelle mais selon une rupture nette : tant que l’esprit reste prisonnier de l’imagination, il se contente d’opinions et d’images floues, sans véritable accès à la vérité. Mais dès que l’homme atteint la connaissance adéquate – d’abord par la raison, puis par l’intuition intellectuelle –, la conscience se déploie d’un seul coup dans sa pleine lumière. C’est une logique du « tout ou rien » : ou bien l’on reste dans l’illusion, ou bien l’on accède à la vérité. Leibniz, au contraire, pense la conscience comme un phénomène progressif. Selon lui, il existe des degrés dans la clarté et la distinction des perceptions : certaines sont confuses et presque imperceptibles, d’autres plus nettes et articulées. Cette vision suppose que la conscience n’est pas un bloc homogène, mais un champ modulable où coexistent différents niveaux d’intensité. Ainsi, le débat entre Spinoza et Leibniz éclaire deux manières de comprendre l’esprit : soit comme un basculement radical, soit comme un continuum de lucidité croissante. \n \n L'HOMME ET L'AUTRE\nLe test du miroir, que certains singes réussissent, interroge : se reconnaître implique-t-il une véritable conscience de soi ? Reconnaître son reflet n’est pas seulement identifier une image, mais se rapporter à soi à travers une médiation symbolique. Chez l’enfant, ce moment fonde une conscience de soi encore fragile. Lacan y voit un « stade du miroir » : je m’identifie à une image qui n’est pas moi, ce qui révèle que l’identité suppose toujours une séparation entre le réel et l’imaginaire. Le miroir révèle une vérité fondamentale : dans la conscience, le sujet existe deux fois, comme sujet regardant et comme objet regardé. Il en est de même dans la mémoire : je me souviens de mon enfance, mais je suis à la fois celui qui se souvient et l’enfant dont je me souviens. La conscience repose donc sur une scission originaire, un écart constitutif entre l’être et son image.\nAvec Fichte, la conscience change de statut. Elle n’est plus définie seulement comme pensée, mais comme action. Le Moi n’existe que dans la mesure où il se pose face au Non-Moi, c’est-à-dire face à une réalité qui lui résiste. La conscience n’est pas contemplation mais activité : elle se constitue en se confrontant au monde. Sa fonction est alors d’être un acte fondateur, une force dynamique, plutôt qu’un simple reflet. Dans Mémoire sur la décomposition de la pensée, Maine de Biran radicalise cette idée. Pour lui, la conscience ne naît pas d’une pure activité intellectuelle, mais de l’expérience concrète de l’effort. Lorsqu’une volonté rencontre une résistance — par exemple, lorsqu’on soulève un objet lourd ou lorsqu’on lutte contre une habitude —, elle prend conscience de son existence. La fonction de la conscience est donc de nous donner une expérience intime du « moi » comme force en action. Sans cette résistance du monde, il n’y aurait ni conscience de soi ni véritable connaissance. La conscience est aussi déterminée par des dynamiques internes et relationnelles. Hegel illustre ce processus à travers la dialectique du Maître et de l’Esclave : la conscience se forme toujours dans une confrontation avec autrui. \n \n FRAGILE CONSCIENCE\nPendant longtemps, de Descartes à Freud, la conscience a été pensée comme une réalité substantielle. Elle était conçue comme une sorte de substrat stable, analogue à une scène de théâtre sur laquelle viennent se jouer des représentations successives sans que la scène elle-même ne soit modifiée. Cette conception permettait de penser l’identité personnelle dans le temps : malgré les changements, quelque chose demeure identique en nous. C’est ce fondement qui rend possible la responsabilité morale (récompense et châtiment), mais aussi la continuité de l’expérience. Descartes illustre cette perspective avec le cogito, qui pose la conscience comme un absolu, un point d’appui premier. Chez Kant, cette fonction fondatrice est reprise sous la forme de l’aperception transcendantale : la conscience de l’unité de soi est une condition nécessaire pour rendre cohérentes toutes nos représentations.\nSartre, de son côté, renverse la tradition cartésienne. Pour lui, la conscience irréfléchie (pré-réflexive) est plus fondamentale que la conscience réfléchie. La conscience n’est pas seulement connaissance mais existence, et elle se joue elle-même dans la mauvaise foi : elle peut se tromper sur elle-même, mais jamais totalement. Il existe un jeu entre soi et soi, mais ce jeu est limité.\nFace à cette tradition, une critique s’est développée : et si la conscience n’était pas première, mais seconde ? Freud, par exemple, montre que le moi conscient n’est qu’une « pauvre chose » (eine armes Ding), largement dépendante de processus inconscients. Nietzsche avait déjà ouvert la voie en dénonçant le cogito comme un préjugé philosophique : comment savoir que je pense, si je ne possède pas déjà une conception préalable de ce qu’est la pensée ? La certitude immédiate que Descartes revendique n’est pas donnée, mais présupposée.\nSelon Nietzsche, la conscience se développe par la mise en commun de nos idées« moyennes», comme une maladie contagieuse qui vulgarise nos intuitions et nous éloigne de nos meilleurs instincts. La conscience ne naît pas de l’individu isolé mais de la vie communautaire : elle est d’abord un outil de communication. Ce qui devient conscient est réduit en mots et en signes, donc appauvri : la conscience transforme le vécu singulier en représentations générales et superficielles. Ainsi, la conscience est à la fois une falsification du réel et un danger pour l’homme moderne, pouvant être vue comme une maladie.\nPour Marx, la conscience n’est pas première : elle est un produit social. « Ce n’est pas la conscience qui détermine l’être, mais l’être qui détermine la conscience ». Autrement dit, les conditions matérielles et sociales de la vie façonnent la manière dont nous pensons et nous représentons le monde. Chaque époque historique engendre ainsi une forme spécifique de conscience : chez les Grecs, la conscience de l’homme face au logos ; dans le christianisme, la conscience déchirée par la faute et la rédemption ; à l’époque moderne, la conscience individuelle, libre et responsable. Ces transformations montrent que la conscience n’est pas universelle et immuable, mais marquée par l’histoire et les contradictions sociales.\nDans cette perspective, elle est comprise comme une fonction exécutive supérieure, un produit dérivé d’autres conditions plus fondamentales. Elle n’est pas un phénomène originaire mais le résultat de déterminations multiples : physiques (organisation neurobiologique du cerveau), sociales (cadres culturels, langage, institutions), psychiques (désirs, pulsions, inconscient). La conscience, loin d’être absolue et auto-fondée, apparaît ainsi comme le sommet fragile et contingent d’un édifice plus vaste, qui la dépasse et la conditionne. \n \n CONSCIENCE IDENTITE\nWilliam James met en avant une fonction : la continuité de l’expérience. La conscience est pour lui un flux (stream of consciousness) où se mêlent ruptures et continuité. Elle nous permet de lier nos perceptions, nos souvenirs et nos pensées en une expérience vécue comme cohérente. Sa fonction est donc intégrative : elle relie entre elles des impressions fragmentées pour donner l’impression d’un moi stable.\nPour David Hume, philosophe sceptique du XVIIIᵉ siècle, l’idée d’un « moi » stable est une illusion. Lorsque nous observons notre esprit, nous ne percevons jamais une substance qui serait le « moi », mais uniquement des perceptions particulières : des sensations, des souvenirs, des désirs, des émotions. Ces perceptions s’enchaînent dans le temps comme les perles d’un collier, mais il n’existe pas de fil invisible qui les relierait. Ainsi, le moi permanent n’est pas une donnée immédiate de la conscience, mais une reconstruction, presque une habitude mentale, qui nous fait croire à une identité continue. Cette analyse conduit Hume à conclure que la conscience est fondamentalement fragmentée et incapable de saisir directement une essence personnelle.\nÀ l’opposé, Henri Bergson, au tournant du XIXᵉ et du XXᵉ siècle, insiste sur le caractère dynamique de la conscience. Pour lui, celle-ci est intimement liée à la liberté de choix. Un être vivant peu libre (par exemple un animal qui agit par automatisme) aura une conscience limitée, presque endormie. À l’inverse, plus un être est capable de poser des choix créatifs et imprévus, plus sa conscience s’intensifie. La conscience est donc proportionnelle au degré de spontanéité et de créativité de la vie. C’est pourquoi elle « s’exalte » dans l’activité inventive et « s’éteint » dans la routine mécanique. Elle n’est pas une abstraction immobile, mais une énergie variable, liée à l’élan vital.\nEdmund Husserl, fondateur de la phénoménologie, propose une approche différente. Il refuse de concevoir la conscience comme une chose ou une substance indépendante. Son concept central est celui d’intentionnalité : toute conscience est conscience de quelque chose. Cela signifie que la conscience est toujours tournée vers un objet, réel ou imaginaire, présent ou possible. Elle n’est pas enfermée en elle-même, mais constitue un espace d’ouverture vers le monde. Cette conception permet de comprendre comment les phénomènes apparaissent à nous, chacun selon un certain mode (perception réelle, souvenir, anticipation, imagination). Le rôle de la conscience n’est donc pas de posséder une identité fixe, mais de donner sens et de rendre possible l’expérience.\nEnfin, Jean-Paul Sartre, héritier et critique de Husserl, va encore plus loin. Pour lui, la conscience est avant tout un rapport à l’être. Elle ne se définit pas par accumulation de savoir, mais par le fait qu’elle est toujours en décalage avec elle-même : jamais figée, jamais coïncidente. Sartre parle du pour-soi, une conscience qui existe en se projetant au-delà de ce qu’elle est déjà. Cette distance fait d’elle une liberté, car elle peut se redéfinir à chaque instant. Mais cette liberté est également un risque : la conscience peut fuir cette responsabilité en se mentant à elle-même, par exemple en prétendant que nos choix sont imposés par les circonstances. Sartre appelle cela la mauvaise foi. La conscience est donc inséparablement liberté et fragilité, ouverture et possibilité d’auto-illusion. \n \n MATERIALITE CONSCIENCE\nDepuis Descartes, la philosophie et les sciences de l’esprit se heurtent à une énigme centrale : comment la conscience, immatérielle, subjective et qualitative, peut-elle surgir d’un corps matériel et quantifiable, en particulier du cerveau ? L’expérience vécue — douleur, fatigue, effort, joie — témoigne à la fois de leur étroite interdépendance et de leur différence de nature. Ce problème s’inscrit dans une tradition ancienne : le platonisme et le christianisme avaient déjà introduit une conception dualiste, opposant l’âme immatérielle au corps périssable. Descartes reprend ce dualisme sous la forme de deux substances distinctes, la res cogitans (pensante) et la res extensa (étendue), unies mystérieusement. Mais sa théorie échoue à expliquer l’interaction effective entre ces deux ordres. Pour pallier cette difficulté, certains de ses successeurs inventent des solutions métaphysiques : Malebranche avec l’« occasionnalisme » (Dieu assure à chaque instant la correspondance entre les deux substances), et Leibniz avec l’« harmonie préétablie » (les monades évoluent parallèlement, sans interaction réelle). Spinoza rompt avec ce schéma : il refuse le dualisme et affirme qu’il n’existe qu’une seule substance, que l’on peut saisir sous deux attributs, pensée et étendue. C’est ce qu’on appelle plus tard la théorie du « double aspect » : le mental et le physique ne sont pas deux réalités distinctes, mais deux manières de décrire un même ordre.\nLes conceptions modernes, souvent matérialistes, déplacent le problème. Le cerveau est reconnu comme le siège des phénomènes mentaux, mais reste à comprendre comment l’activité locale de milliards de neurones peut donner lieu à une unité subjective, continue et qualitative — le fameux « problème corps-esprit ». Le matérialisme réductionniste tente de ramener la conscience à la chimie cérébrale, mais se heurte à l’« irréductibilité » de l’expérience vécue : par exemple, la souffrance ne se réduit pas au seul influx nerveux, elle possède une dimension phénoménale singulière. L’émergentisme soutient que la conscience est une propriété nouvelle, émergente de la complexité du cerveau, mais qui ne se laisse pas réduire aux mécanismes élémentaires. Enfin, le fonctionnalisme propose une voie médiane : il reste matérialiste, mais non réductionniste. Selon lui, les états mentaux doivent être définis par leur rôle (par exemple, percevoir, mémoriser, décider) et non par leur seul substrat matériel. La conscience devient alors un niveau fonctionnel d’organisation : inséparable du cerveau, mais irréductible à la matière brute, comme le logiciel par rapport au matériel informatique.", 
  },
  { x: 200, y: 400, img: "Philo/Devoir.png", type: "info", 
    label:"Devoir",
    contentImg:"Philo/Conscience2.png",
    contentText:"INTRODUCTION\nKant souligne que le devoir n’existe que pour une volonté qui n’est pas parfaitement bonne. Dieu et les saints n’ont pas de devoirs, car leur volonté est immédiatement conforme au bien. Chez les hommes, au contraire, l’obligation est contingente : elle existe parce qu’on peut la transgresser. L’homme est comme un « délinquant potentiel ». Bergson ajoute que « l’obéissance au devoir est une résistance à soi-même » : dire « je dois » signifie toujours une contrainte intérieure, un effort pour s’arracher à ses penchants. Rousseau, dans Du contrat social, marque une rupture entre l’état de nature et l’état civil : l’homme y substitue l’« impulsion physique » par la « voix du devoir ». Cette idée est décisive : dans la nature, rien ne se donne sous la forme d’une obligation. Le devoir est une invention humaine. \n \n OBLIGATION DU DEVOIR\nDans l’Antiquité, la notion de devoir s’enracine dans la vie civique et sociale. Cicéron, dans son traité Des Devoirs (De Officiis), insiste sur le fait que tout acte humain — qu’il soit politique ou domestique — doit être guidé par ce que l’on appelle l’officium, c’est-à-dire ce qui convient à l’homme en tant qu’être raisonnable et citoyen. Par exemple, participer aux affaires publiques, défendre la cité, ou encore maintenir la concorde familiale sont perçus comme des devoirs naturels. Le citoyen romain accomplit son devoir en prenant part à la vie politique de la République ou en rendant la justice. Même dans la sphère privée, des gestes simples — comme honorer ses parents ou bien gérer son patrimoine — ne sont pas imposés par une loi transcendante mais apparaissent comme conformes à l’ordre naturel des choses et nécessaires à l’harmonie collective.\nVictor Brochard a raison de dire que les Anciens ne parlaient pas de morale sous l’angle de l’obligation, mais sous celui de l’art de vivre. Les philosophes grecs en donnent de multiples exemples. Chez Aristote, le problème moral se résume à : « Comment atteindre le bonheur (eudaimonia) ? » Ce bonheur n’est pas un plaisir passager, mais un accomplissement durable qui suppose de cultiver des vertus : le courage, la tempérance, la justice, la prudence. Ainsi, un guerrier courageux n’agit pas parce qu’une loi lui ordonne d’affronter le danger, mais parce que le courage est l’expression de sa nature rationnelle et la voie de son épanouissement. De même, le philosophe stoïcien, comme Épictète, ne cherche pas à obéir à une obligation imposée de l’extérieur, mais à vivre en accord avec la raison universelle, le logos, en acceptant ce qui dépend de lui et en maîtrisant ses passions. L’exigence morale se confond ici avec la recherche d’une vie bonne, sensée, heureuse. L’opposition entre bonheur et devoir ne prend forme qu’avec le christianisme. L’idée de devoir dérive désormais de la dette de l’homme envers Dieu. Par exemple, aimer son prochain, pardonner à ses ennemis ou renoncer aux plaisirs de ce monde ne sont pas vus comme des choix spontanés menant à la félicité terrestre, mais comme des exigences issues de la Révélation et des commandements divins. Le chrétien est redevable de son existence au Créateur et doit donc obéir à sa loi. Saint Augustin illustre bien ce déplacement : la vie morale consiste moins à rechercher la vertu pour elle-même qu’à orienter son âme vers Dieu, parfois contre ses désirs immédiats. Ici, le devoir devient une obéissance à une autorité transcendante, et la sanction n’est plus l’échec du bonheur humain mais le salut ou la damnation éternelle.\nDans la pensée indienne, l’homme n’est pas perçu comme un être autonome qui entrerait librement dans la vie, mais comme un être redevable dès sa naissance. Selon les textes védiques et brahmaniques, l’existence humaine est placée sous le signe de la dette (ṛṇa). On distingue traditionnellement plusieurs dettes fondamentales : la dette envers les dieux, qui réclame des sacrifices et des rituels pour maintenir l’ordre cosmique ; la dette envers les ancêtres, qui impose de donner une descendance et d’accomplir les rites funéraires ; la dette envers les sages, qui se rembourse par l’étude et la transmission du savoir ; parfois même la dette envers l’humanité, qui se manifeste par l’hospitalité et la solidarité. Ainsi, chaque étape de la vie est interprétée comme un moyen d’acquitter une part de cette dette universelle. Le principe qui rassemble ces obligations multiples est le Dharma. Le Dharma n’est pas seulement une règle morale au sens restreint : c’est à la fois la loi, le devoir, l’ordre du monde et la voie juste que chaque individu doit suivre. Par exemple, un roi doit assurer la justice et la protection du peuple, un brahmane doit enseigner et accomplir les sacrifices, un marchand doit pratiquer le commerce honnêtement, un serviteur doit obéir et soutenir. Chaque caste (varna) et chaque étape de la vie (āśrama) ont ainsi leurs propres devoirs spécifiques (svadharma). Le Dharma est donc une force impersonnelle et cosmique : respecter son Dharma, c’est contribuer à maintenir l’équilibre du monde ; le négliger, c’est introduire le désordre dans l’univers. Cette vision contraste à la fois avec la morale antique grecque et avec la morale chrétienne. Contrairement aux Grecs, qui cherchaient surtout à savoir « comment vivre pour être heureux », les Indiens mettent l’accent sur la dette ontologique : vivre, c’est déjà devoir. Mais contrairement au christianisme, où le devoir est souvent pensé comme une relation verticale envers un Dieu transcendant, le Dharma est immanent à l’ordre cosmique : il n’existe pas un législateur extérieur, mais une structure de l’univers que chacun doit respecter. Ainsi, l’homme n’est jamais « libre » de choisir s’il veut ou non accomplir son devoir : sa vie est insérée d’emblée dans ce réseau d’obligations, et son salut (moksha, la libération) dépend de la manière dont il s’en acquitte.\nAu siècle des Lumières, beaucoup commencent à voir dans la société — et ses convenances — l’origine des devoirs. Kant s’oppose radicalement à cette idée. Pour lui, les devoirs ne sont pas des conventions sociales mais des nécessités rationnelles. Dans sa Métaphysique des mœurs, il distingue deux sphères : La doctrine du droit, qui concerne les obligations extérieures, réglées par la loi, et donc hétéronomes. La doctrine de la vertu, qui concerne les obligations intérieures, fondées sur l’autonomie morale. Cette séparation du droit et de la morale est capitale : le droit règle les comportements en vue de fins extérieures, alors que la morale pose le devoir comme principe en lui-même. Kant établit une différence essentielle entre : Agir conformément au devoir : par exemple, dire la vérité pour éviter des ennuis. Agir par devoir : dire la vérité uniquement parce que c’est une exigence morale, sans considération des conséquences. Seule la seconde attitude a une véritable valeur morale. C’est ici qu’intervient l’impératif catégorique, principe universel qui ordonne inconditionnellement. Il ne se définit pas par un contenu concret (« fais ceci » ou « ne fais pas cela »), mais par une forme : la possibilité d’universaliser la maxime de son action sans contradiction. Ainsi, je n’agis moralement que si je peux vouloir que tous fassent de même. Pour Kant, le devoir ne vient pas des conditions naturelles ou sensibles, mais de la raison elle-même, qui est capable de produire un ordre moral a priori. Le devoir est une « proposition synthétique a priori » : il n’est pas dérivé de l’expérience mais découle des structures de la raison pratique. Le bien moral ne dépend donc ni de l’agrément, ni de l’utilité sociale, ni des résultats (il récuse ainsi les morales conséquentialistes). \n \n DROIT ET DEVOIR\nLeur relation première semble être celle de l’opposition : le droit est liberté et indétermination, tandis que le devoir est contrainte et détermination stricte. Mais il existe aussi une relation de réciprocité : tout droit suppose un devoir correspondant, et inversement. Pourtant, cette symétrie n’est pas parfaite : les enfants ont des droits sans devoirs, et selon Hegel les esclaves n’ayant pas de droits n’ont pas non plus de devoirs. Historiquement, avant l’avènement du libéralisme, les sociétés étaient organisées autour des devoirs plus que des droits. La Révolution française illustre bien la tension : certains voulaient une Déclaration des devoirs en parallèle à la Déclaration des droits, mais cette idée fut rejetée comme rétrograde.\nPour Auguste Comte, fondateur du positivisme, parler de « droits » est une erreur fondamentale. Selon lui, les droits nourrissent l’individualisme, en donnant à chacun l’illusion qu’il peut revendiquer des privilèges sans tenir compte des autres. De plus, ils favorisent l’anarchie sociale, car si chacun s’appuie sur ses « droits » pour exiger, il devient impossible de maintenir l’ordre collectif. Par exemple, si les ouvriers réclament des droits contre les patrons et les patrons des droits contre les ouvriers, la société risque de se fragmenter en conflits permanents. À l’inverse, Comte affirme qu’il n’existe qu’un seul droit véritable : le droit de faire son devoir. Autrement dit, la liberté individuelle n’a de valeur que dans la mesure où elle permet à chacun de remplir ses obligations envers la société. Ainsi, ce qui compte n’est pas ce que l’individu peut revendiquer, mais ce qu’il peut apporter à l’ensemble. Par exemple, le devoir de l’enseignant est de transmettre le savoir, le devoir du médecin de soigner, le devoir du citoyen de participer à la vie publique : c’est dans l’accomplissement de ces fonctions que réside leur dignité, et non dans la défense de prétendus « droits subjectifs ». Derrière cette radicalité se cache un projet social cohérent : Comte veut orienter l’humanité vers l’ordre et la solidarité. Selon lui, seule une éthique des devoirs peut cimenter la société et dépasser les conflits d’intérêts. Les devoirs ne sont pas pensés comme de simples contraintes extérieures, mais comme des liens organiques qui unissent chaque individu au tout social. De ce point de vue, l’individu n’existe pas isolément : il est toujours le membre d’une famille, d’une nation, de l’humanité. En niant les droits, Comte veut empêcher l’éclatement de la société et promouvoir un idéal d’altruisme, où chacun vit pour autrui.\nSimone Weil commence par reconnaître que droits et devoirs sont intimement liés : ils constituent les deux faces d’une même réalité sociale et morale. Si quelqu’un a un droit, c’est toujours parce qu’un autre a un devoir correspondant. Par exemple, mon droit à l’éducation correspond au devoir de l’État et des enseignants de me la fournir ; mon droit à la sécurité suppose le devoir d’autrui de ne pas m’agresser. Sur ce point, Weil rejoint l’idée classique de réciprocité entre droits et devoirs. Simone Weil reproche à notre époque moderne de préférer inventer des droits (droits des animaux, droits de la nature, droits des générations futures) plutôt que d’assumer pleinement nos devoirs envers eux. Parler de « droits de la nature », dit-elle, est une illusion : la nature n’est pas un sujet juridique capable de revendiquer. En revanche, parler de notre devoir de préserver la nature est bien plus exigeant : cela nous oblige directement, sans détour, à modifier nos comportements. Selon Weil, cette inflation de droits traduit une fuite devant la responsabilité.\n \n DEVOIR = BIEN ?\nSelon Constant, les principes moraux ne peuvent pas s'appliquer d'une façon abstraite à toute situation particulière. Pour illustrer ce point de vue, Constant prend pour exemple le devoir de vérité. Dire la vérité n'est donc un devoir qu'envers ceux qui ont droit à la vérité. Or nul homme n'a droit à la vérité qui nuit à autrui.\nSchopenhauer s’attaque frontalement à l’idée kantienne d’un devoir universel, fondé sur l’« impératif catégorique ». Pour Kant, le devoir est indépendant de nos intérêts et s’impose par pure nécessité rationnelle : il faut agir comme si la maxime de notre action pouvait devenir une loi universelle. Mais Schopenhauer dénonce ce fondement abstrait et affirme que, derrière ce langage moral élevé, se cache toujours l’égoïsme humain. Selon lui, lorsqu’on parle de devoir, il ne s’agit souvent que d’une formulation sophistiquée d’un principe beaucoup plus simple et ancien : « Ne fais pas à autrui ce que tu ne voudrais pas qu’on te fasse ». Autrement dit, ce n’est pas la raison pure qui fonde la morale, mais le souci instinctif de se protéger et de limiter la souffrance. Par exemple, si je m’abstiens de voler, ce n’est pas parce qu’une loi morale universelle l’exige, mais parce que je n’aimerais pas être volé moi-même. Schopenhauer dévoile ainsi une dimension pragmatique et désenchantée du devoir, qui se ramène à la réciprocité et à la compassion plutôt qu’à une obligation transcendante.\nDe son côté, Jeremy Bentham propose une autre approche du devoir, avec sa théorie de l’utilitarisme. Pour lui, il ne s’agit pas de se demander si une action est conforme à une loi universelle, mais si elle maximise le bien-être. Le principe fondamental est le « plus grand bonheur du plus grand nombre ». Chaque action doit être évaluée selon son utilité, c’est-à-dire sa capacité à produire du plaisir et à réduire la souffrance. Par exemple, une loi qui taxe lourdement les riches pour améliorer l’éducation publique doit être jugée non pas sur sa conformité à une règle morale abstraite, mais sur ses effets globaux : si elle apporte plus de bonheur (éducation, égalité des chances) que de souffrance (perte de richesse pour quelques-uns), alors elle est moralement justifiée. Bentham va même jusqu’à élaborer une sorte de « calcul des plaisirs » (intensité, durée, certitude, proximité, fécondité, pureté, étendue), pour mesurer l’impact d’une action. Ainsi, le devoir moral se transforme en une éthique pratique, tournée vers les conséquences mesurables des actes.\nLe sentiment d’avoir fait leur devoir n’est-il pas commun aux vilains ? N’est-ce pas ce sentiment qui précisément leur permet d’achever en bonne conscience leur sale besogne ? On n’a pas manqué de rappeler la conception explicitement kantienne du devoir qu’Eichmann développa en guise de justification lors de son procès : l’impératif catégorique débouchant sur les camps de la mort !",      
  },
  { x: 200, y: 300, img: "Philo/Devoir.png", type: "info", 
    label:"Devoir",
    contentImg:"Philo/Conscience2.png",
    contentText:"XXX"
  },
  { x: 100, y: 300, img: "Philo/Devoir.png", type: "info", 
    label:"Devoir",
    contentImg:"Philo/Conscience2.png",
    contentText:"XXX"
  },
  { x: 300, y: 300, img: "Philo/Devoir.png", type: "info", 
    label:"Devoir",
    contentImg:"Philo/Conscience2.png",
    contentText:"XXX"
  },
  { x: 400, y: 300, img: "Philo/Devoir.png", type: "info", 
    label:"Devoir",
    contentImg:"Philo/Conscience2.png",
    contentText:"XXX"
  },
  { x: 500, y: 300, img: "Philo/Devoir.png", type: "info", 
    label:"Devoir",
    contentImg:"Philo/Conscience2.png",
    contentText:"XXX"
  },
  { x: 600, y: 300, img: "Philo/Devoir.png", type: "info", 
    label:"Devoir",
    contentImg:"Philo/Conscience2.png",
    contentText:"XXX"
  },
  { x: 700, y: 300, img: "Philo/Devoir.png", type: "info", 
    label:"Devoir",
    contentImg:"Philo/Conscience2.png",
    contentText:"XXX"
  },
  { x: 100, y: 500, img: "Philo/Devoir.png", type: "info", 
    label:"Devoir",
    contentImg:"Philo/Conscience2.png",
    contentText:"XXX"
  },
  { x: 200, y: 500, img: "Philo/Devoir.png", type: "info", 
    label:"Devoir",
    contentImg:"Philo/Conscience2.png",
    contentText:"XXX"
  },
  { x: 300, y: 500, img: "Philo/Devoir.png", type: "info", 
    label:"Devoir",
    contentImg:"Philo/Conscience2.png",
    contentText:"XXX"
  },
  { x: 400, y: 500, img: "Philo/Devoir.png", type: "info", 
    label:"Devoir",
    contentImg:"Philo/Conscience2.png",
    contentText:"XXX"
  },
  { x: 500, y: 500, img: "Philo/Devoir.png", type: "info", 
    label:"Devoir",
    contentImg:"Philo/Conscience2.png",
    contentText:"XXX"
  },
  { x: 600, y: 600, img: "Philo/Devoir.png", type: "info", 
    label:"Devoir",
    contentImg:"Philo/Conscience2.png",
    contentText:"XXX"
  },
    { x: 100, y: 600, img: "Philo/Devoir.png", type: "info", 
    label:"Devoir",
    contentImg:"Philo/Conscience2.png",
    contentText:"XXX"
    }
];

const PLAYER_SPEED = 600;
const CLICK_RADIUS = 50;
const DETECTION_RADIUS = 60;

/* ========================== */
let state = {
  mapObj: null,
  player: { x: 100, y: 100 },
  keys: {},
  lastTs: null,
  dragging: false
};

/* DOM elements */
const viewport = document.getElementById('viewport');
const mapEl = document.getElementById('map');
const playerEl = document.getElementById('player');
const posEl = document.getElementById('pos');
const mapNameEl = document.getElementById('mapName');
const locLabelEl = document.getElementById('locLabel');
const modal = document.getElementById('modal');
const modalImg = document.getElementById('modalImg');
const modalText = document.getElementById('modalText');

/* Charger une map */
function loadMap(mapIdOrObj){
  const mapObj = (typeof mapIdOrObj === 'string') ? MAPS[mapIdOrObj] : mapIdOrObj;
  if(!mapObj){ console.error("Map introuvable :", mapIdOrObj); return; }

  state.mapObj = mapObj;
  mapEl.style.width = mapObj.width + "px";
  mapEl.style.height = mapObj.height + "px";
  mapEl.style.backgroundImage = `url("${mapObj.bg}")`;
  mapEl.style.backgroundSize = "cover";
  mapEl.style.backgroundPosition = "center center"; // <-- ajout important

  mapNameEl.textContent = mapObj.name || mapObj.id || "";

  // Attendre que l’image soit bien chargée avant de centrer
  const img = new Image();
  img.onload = () => {
    renderMarkers();
    clampPlayer();
    centerOnPlayer();
  };
  img.src = mapObj.bg;
}

/* Initialisation */
function init(){
  loadMap(CURRENT_MAP_ID);
  // Placer le joueur au centre logique de la map
  state.player.x = MAPS[CURRENT_MAP_ID].width / 2;
  state.player.y = MAPS[CURRENT_MAP_ID].height / 2;

  // Centrage après rendu complet
  window.addEventListener("load", () => {
    centerOnPlayer();
    updateHUD();
    requestAnimationFrame(loop);
  });
}

/* Rendu des marqueurs */
function renderMarkers(){
  mapEl.querySelectorAll('.marker').forEach(n => n.remove());
  LOCATIONS.forEach((loc, idx) => {
    const i = document.createElement('img');
    i.src = loc.img;
    i.className = 'marker';
    i.style.left = loc.x + 'px';
    i.style.top = loc.y + 'px';
    i.alt = loc.label || ("loc"+idx);
    i.dataset.idx = idx;
    i.addEventListener('click', (ev) => {
      ev.stopPropagation();
      handleLocationClick(loc);
    });
    i.addEventListener('mouseenter', () => locLabelEl.textContent = loc.label);
    i.addEventListener('mouseleave', () => locLabelEl.textContent = "");
    mapEl.appendChild(i);
  });
}

/* Action selon le type */
function handleLocationClick(loc){
  if(!loc) return;
  switch(loc.type){
    case 'info':
      showModal(loc.contentImg, loc.contentText);
      break;
    case 'map':
      if(MAPS[loc.link]) loadMap(loc.link);
      else if (loc.link.endsWith('.html')) window.location.href = loc.link;
      break;
    default:
      console.warn("Type non géré:", loc.type);
  }
}

/* Affichage du modal */
function showModal(imgSrc, text){
  modal.style.display = 'flex';
  modalImg.src = imgSrc || '';
  modalText.innerHTML = formatText(text || '');
}

/* Masquer le modal */
function hideModal(){
  modal.style.display = 'none';
  modalImg.src = '';
  modalText.textContent = '';
}

/* Formater le texte : \n = <br>, \n\n = <br><br> */
function formatText(str){
  return str
    .replace(/\n\s*\n/g, '<br><br>')
    .replace(/\\n/g, '<br>');
}

/* Centrage sur le joueur */
function centerOnPlayer(){
  const vpW = viewport.clientWidth;
  const vpH = viewport.clientHeight;
  const mapW = mapEl.clientWidth;
  const mapH = mapEl.clientHeight;
  let offsetX = vpW/2 - state.player.x;
  let offsetY = vpH/2 - state.player.y;
  offsetX = Math.min(0, Math.max(vpW - mapW, offsetX));
  offsetY = Math.min(0, Math.max(vpH - mapH, offsetY));
  mapEl.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
  playerEl.style.left = state.player.x + 'px';
  playerEl.style.top = state.player.y + 'px';
}

/* Limiter les coordonnées */
function clampPlayer(){
  if(!state.mapObj) return;
  state.player.x = Math.max(0, Math.min(state.mapObj.width, state.player.x));
  state.player.y = Math.max(0, Math.min(state.mapObj.height, state.player.y));
}

/* Déplacement clavier */
window.addEventListener('keydown', (e)=> state.keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', (e)=> state.keys[e.key.toLowerCase()] = false);

/* Drag */
let dragOffset = {x:0,y:0};
playerEl.addEventListener('pointerdown', (ev)=>{
  ev.preventDefault();
  playerEl.setPointerCapture(ev.pointerId);
  state.dragging = true;
  dragOffset.x = ev.clientX;
  dragOffset.y = ev.clientY;
});
playerEl.addEventListener('pointermove', (ev)=>{
  if(!state.dragging) return;
  const dx = ev.clientX - dragOffset.x;
  const dy = ev.clientY - dragOffset.y;
  state.player.x += dx;
  state.player.y += dy;
  dragOffset.x = ev.clientX;
  dragOffset.y = ev.clientY;
  clampPlayer();
  centerOnPlayer();
  updateHUD();
});
playerEl.addEventListener('pointerup', (ev)=>{
  state.dragging = false;
  try{ playerEl.releasePointerCapture(ev.pointerId);}catch(e){}
});

/* HUD dynamique */
function updateHUD(){
  posEl.textContent = `x:${Math.round(state.player.x)} y:${Math.round(state.player.y)}`;
  let nearest = null, bestDist = Infinity;
  LOCATIONS.forEach(loc => {
    const d = Math.hypot(state.player.x - loc.x, state.player.y - loc.y);
    if (d < bestDist) { bestDist = d; nearest = loc; }
  });
  locLabelEl.textContent = (nearest && bestDist < DETECTION_RADIUS) ? nearest.label : "";
}

/* Boucle principale */
function loop(ts){
  if(!state.lastTs) state.lastTs = ts;
  const dt = (ts - state.lastTs) / 1000;
  state.lastTs = ts;
  let dx = 0, dy = 0;
  if(state.keys['arrowup'] || state.keys['w']) dy -= 1;
  if(state.keys['arrowdown'] || state.keys['s']) dy += 1;
  if(state.keys['arrowleft'] || state.keys['a']) dx -= 1;
  if(state.keys['arrowright'] || state.keys['d']) dx += 1;
  if(dx || dy){
    const len = Math.hypot(dx,dy) || 1;
    state.player.x += (dx/len) * PLAYER_SPEED * dt;
    state.player.y += (dy/len) * PLAYER_SPEED * dt;
    clampPlayer();
    centerOnPlayer();
    updateHUD();
  } else updateHUD();
  requestAnimationFrame(loop);
}

/* Initialisation */
function init(){
  loadMap(CURRENT_MAP_ID);
  // On centre le joueur au milieu de la carte
  state.player.x = state.mapObj.width / 2;
  state.player.y = state.mapObj.height / 2;

  // On attend que la map soit bien rendue avant de centrer
  requestAnimationFrame(() => {
    centerOnPlayer();
    updateHUD();
    requestAnimationFrame(loop);
  });
}

init();
</script>
</body>
</html>
