<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Map interactive — fenêtres de contenu</title>
<style>
  :root{
    --ui-bg: rgba(0,0,0,0.6);
    --ui-color: #fff;
    --player-size: 50px;
    --marker-size: 80px;
  }
  html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;}
  #app{height:100vh;display:flex;flex-direction:column;}
  #hud{
    position:fixed; left:10px; top:10px; z-index:30;
    background:var(--ui-bg); color:var(--ui-color); padding:8px 12px;border-radius:8px;
    font-size:14px; box-shadow:0 4px 12px rgba(0,0,0,.4);
    user-select:none;
  }
  #hud b{display:inline-block; min-width:80px;}
  #viewport{
    position:relative; flex:1; overflow:hidden; background:#222;
  }
  #map{
    position:absolute; left:0; top:0;
    transform-origin:0 0;
  }
  #player{
    position:absolute;
    width:var(--player-size); height:var(--player-size);
    margin-left: calc(var(--player-size) / -2);
    margin-top: calc(var(--player-size) / -2);
    z-index:40;
    cursor:grab;
    transition: transform .03s linear;
  }
  #player:active{cursor:grabbing;}
  .marker{
    position:absolute;
    width:var(--marker-size); height:var(--marker-size);
    margin-left: calc(var(--marker-size) / -2);
    margin-top: calc(var(--marker-size) / -2);
    z-index:35;
    pointer-events:auto;
    user-select:none;
  }
  /* ==================== MODALE ==================== */
  #modal{
    display:none; position:fixed; inset:0; z-index:100; 
    background: rgba(0,0,0,.7);
    align-items:center; justify-content:center;
    padding:20px;
  }
  #modalContent{
    background:#fff; color:#000;
    max-width:600px; max-height:80vh;
    overflow-y:auto;
    border-radius:10px;
    padding:20px;
    box-shadow:0 10px 40px rgba(0,0,0,.5);
    text-align:center;
  }
  #modalContent img{
    max-width:100%;
    height:auto;
    border-radius:8px;
    margin-bottom:12px;
  }
  #closeBtn{
    background:#222; color:#fff;
    border:none;
    padding:8px 16px;
    border-radius:6px;
    cursor:pointer;
    margin-top:10px;
  }
  #tips{
    position:fixed; right:10px; top:10px; z-index:30;
    background:var(--ui-bg); color:var(--ui-color); padding:8px 12px;border-radius:8px;
    font-size:13px; max-width:220px;
  }
  @media (max-width:600px){
    #hud {font-size:12px}
    :root{--player-size:28px; --marker-size:28px;}
  }
</style>
</head>
<body>
<div id="app">
  <div id="hud">
    <div><b>Position</b> <span id="pos">x:0, y:0</span></div>
    <div style="margin-top:6px"><b>Map</b> <span id="mapName"></span></div>
    <div style="margin-top:6px"><b>Lieu</b> <span id="locLabel"></span></div>
  </div>

  <div id="viewport">
    <div id="map">
      <img id="player" src="data:image/svg+xml;utf8,
        <svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 24 24' fill='none' stroke='%23ffcc00' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'><circle cx='12' cy='10' r='3.2' /><path d='M12 2v3M12 21v-3M20 12h-3M7 12H4M17.5 6.5L15.5 8.5M8.5 15.5L6.5 17.5M17.5 17.5L15.5 15.5M8.5 8.5L6.5 6.5' /></svg>" alt="player" draggable="false">
    </div>
  </div>

  <!-- Fenêtre modale -->
  <div id="modal">
    <div id="modalContent">
      <img id="modalImg" src="" alt="">
      <div id="modalText"></div>
      <button id="closeBtn" onclick="hideModal()">Fermer</button>
    </div>
  </div>
</div>

<script>
/* ==========================
   CONFIGURATION
   ========================== */
const MAPS = {
  "ville-centre": {
    id: "ville-centre",
    name: "Ville - Centre",
    bg: "Sous Map/Vert.png",
    width: 1300,
    height: 600
  }
};

// Map de départ
let CURRENT_MAP_ID = "ville-centre";

/* Exemple : chaque lieu peut maintenant avoir :
   - type: 'info' → ouvrira une fenêtre dans la page
   - img: image à afficher
   - text: texte avec \n ou \n\n
*/
let LOCATIONS = [
  { x: 200, y: 200, img: "Philo/Bonheur.png", type: "info", 
    label:"Bonheur",
    contentImg:"Philo/Bonheur2.png",
    contentText:"HIERARCHIE DU BONHEUR\n Plaisir → lié au corps, instantané, mode de consommation.\n Joie → liée à la création, durée, émotion active.\n Bonheur → état existentiel de l’être, temporalité : la vie.\n Béatitude → liée à l’âme et à Dieu, transcendance, éternité.\n Dans cette échelle, le plaisir est jugé inférieur (corporel) et la béatitude supérieure (divine). Le bonheur occupe une place intermédiaire, terrestre.\n Platon : le plaisir est mêlé à la douleur → impur, alors que le bonheur doit être sans mélange. Sénèque : le plaisir existe aussi chez les fous et les méchants → il ne peut définir le bonheur.\n \n Calliclès soutient que le vrai bonheur consiste à laisser libre cours à ses passions, aussi grandes soient-elles, et à les assouvir grâce au courage et à l’intelligence. Selon lui, la masse, incapable d’une telle intensité de vie, érige artificiellement la tempérance et la justice en vertus, par faiblesse. Socrate, en réponse, illustre deux styles de vie par une métaphore des tonneaux : l’homme tempérant, dont les tonneaux sont pleins, vit dans la tranquillité, tandis que l’homme insatiable, aux tonneaux percés, doit remplir sans cesse et souffre de son manque. Il montre ainsi que la tempérance assure paix et stabilité.\n \n  Mieux vaut être Socrate insatisfait qu’un imbécile satisfait (J.S. Mill) Cette phrase est centrale dans la philosophie utilitariste de John Stuart Mill, qui voulait distinguer les plaisirs inférieurs (corporels, immédiats, communs aux animaux) et les plaisirs supérieurs (intellectuels, spirituels, esthétiques). Le paradoxe : Socrate, en tant que philosophe, est capable de rechercher la vérité, de comprendre, de juger et de réfléchir. Mais cette quête entraîne souvent de l’insatisfaction : le savoir fait prendre conscience des limites de la vie, de la souffrance, de l’injustice. À l’inverse,  l’imbécile satisfait  vit dans une jouissance simple, sans se poser de questions, mais cette satisfaction est jugée inférieure en qualité.\n \n \n \n \n BONHEUR COMME CORRESONDANCE AU MONDE OU ACTIVITE ?\n Les grandes philosophies antiques ont défini le bonheur comme indépendance intérieure. Les biens matériels peuvent contribuer au confort, mais ils ne garantissent pas le bonheur : ils rendent souvent dépendants, comme le rappelle Sénèque en distinguant celui qui possède ses richesses de celui qui est possédé par elles. Le bonheur n’est donc pas  avoir plus , mais  être autrement, c’est-à-dire développer une aptitude à se réjouir de ce que l’on a et à vivre en harmonie avec le monde. Les Stoïciens insistaient sur l’accord avec l’ordre du cosmos, Aristote sur l’accomplissement de la nature humaine, et Épicure sur la juste mesure des désirs.  Le bonheur n’est donc pas un plaisir passager, mais une activité vertueuse qui se construit tout au long de la vie, par l’éducation, l’effort et la pratique du bien. En d’autres termes, pour Aristote, on est heureux non pas quand on a beaucoup, mais quand on devient pleinement ce que l’on est : un être raisonnable et juste. Ainsi, vivre en accord avec la raison, c’est orienter sa vie non pas selon les pulsions, les désirs immédiats ou les émotions, mais selon un jugement réfléchi sur ce qui est juste et bon. Cela suppose de trouver la mesure dans nos actions — par exemple, ni trop de peur ni trop d’audace, mais le juste courage. C’est ce qu’Aristote appelle la vertu : le juste milieu entre deux excès. Tous s’accordent sur l idée que l’homme heureux est celui qui transforme son rapport au monde plutôt que d’accumuler des biens. Le bonheur devient ainsi un mode d’être, une manière d’habiter le monde dans l’acceptation de ce qui dépend de nous et dans la sérénité face à ce qui échappe à notre maîtrise.\n \n Le bonheur a été pensé dès l’Antiquité comme la fin suprême de l’existence, à la fois objet universel de désir et principe de la morale (eudémonisme). Dans l’Éthique à Nicomaque, Aristote définit le bonheur comme le bien suprême, fin ultime de l’existence humaine. Il réside dans l’exercice vertueux de la raison, selon la vertu (aretè), et dans l’accomplissement de la nature rationnelle de l’homme. Il n’est pas état passif mais activité en acte. L’intérêt est d’unir bonheur et vertu, en fondant la joie de vivre sur la pleine actualisation des capacités humaines, dans une vie cohérente et réfléchie.\n \n Épicure – Le bonheur est l’ataraxie, absence de trouble de l’âme. Pour Épicure, le bonheur ne réside ni dans les plaisirs excessifs ni dans les honneurs, mais dans un état d’équilibre : l’absence de douleur corporelle (aponie) et l’absence de trouble dans l’âme (ataraxie). Par le calcul rationnel des plaisirs, on élimine les désirs vains, la peur des dieux et de la mort. Le bonheur devient une vie simple, stable, entourée d’amitié et de réflexion.\n L’intérêt est de montrer que le bonheur véritable est accessible à tous, fondé sur la modération et la lucidité plutôt que sur la richesse ou la passion.\n \n Pour Zhuangzi le riche s’épuise sans profiter, le dignitaire vit dans l’angoisse, et la vie, même longue, n’apporte que soucis. Le véritable bonheur ne réside pas dans ces poursuites illusoires mais dans le « non-agir » (wu wei), que la foule méprise. Comme le ciel et la terre, inactifs mais féconds, l’homme devrait apprendre à s’accorder à ce principe : ne pas agir, c’est laisser advenir l’harmonie et préserver l’existence. Ainsi, la joie suprême n’est pas accumulation mais détachement, transparence et stabilité, sources de fécondité véritable.\n \n Nietzsche est en rupture avec la sagesse ancienne. Il rompt avec l’idéal classique du bonheur comme équilibre, harmonie, unité. Pour lui, le bonheur n’est pas un repos, mais un mouvement vital : « Le bonheur est le sentiment que la puissance croît, que l’on surmonte une résistance. »  Le bonheur n’est pas le contentement passif (ataraxie stoïcienne, béatitude chrétienne), mais une affirmation active de la vie, même dans la lutte et la souffrance. Ainsi, Nietzsche substitue au paradigme de l’unité une conception dynamique, agonistique du bonheur. Le grand style de vie consiste à dire oui à l’existence telle qu’elle est, par l’épreuve de l’éternel retour et la volonté de puissance. \n \n Spinoza fait du bonheur non pas un état passager ou un simple sentiment agréable, mais l’expression de la liberté qui se conquiert à travers la connaissance. En comprenant les causes qui déterminent nos affects et nos actions, nous cessons d’être ballottés par les passions et nous devenons actifs, c’est-à-dire auteurs de notre vie. Le bonheur n’est donc pas donné de l’extérieur, mais il résulte d’un travail intérieur de compréhension rationnelle du réel, qui culmine dans ce que Spinoza appelle « l’amour intellectuel de Dieu ». Cela signifie que le bonheur consiste dans la joie d’accepter la nécessité de la nature telle qu’elle est, sans illusions ni révolte, mais en reconnaissant la cohérence et la beauté de l’ordre universel. Ainsi, être heureux n’est pas refuser le réel ni vouloir qu’il soit autre qu’il est, mais en saisir la nécessité et s’y accorder pleinement : c’est en ce sens que Spinoza fait du bonheur une conquête de la sagesse. \n \n Pour Bergson (dans l'énergie spirituelle), l’effort est plus précieux que l’œuvre, car il permet de se dépasser. La matière, en opposant résistance et en se laissant transformer, devient à la fois obstacle, instrument et stimulant. La vraie joie n’est pas dans l’argent, la gloire ou les honneurs, mais dans le sentiment créateur : faire naître quelque chose qui n’existait pas. L’artiste ou le savant trouvent leur joie dans l’accomplissement de leur pensée, non dans l’admiration reçue. Ainsi, la finalité de la vie humaine réside dans la création de soi par soi, dans l’agrandissement intérieur par l’effort, source authentique de joie et de richesse.\n \n \n \n \n ILLUSION DU BONHEUR\n Pour Kant, le bonheur n’est pas un concept clair et rationnel, mais un idéal indéterminé. Pourquoi ? Le bonheur est défini comme « l’état de complète satisfaction de nos désirs », mais nos désirs sont multiples, changeants, contradictoires. Ce qui rend heureux l’un peut rendre malheureux l’autre (richesse, santé, gloire, amour…). Même pour une seule personne, la conception du bonheur change avec les circonstances : le malade veut la santé, le pauvre veut la richesse, etc. La contradiction interne : Tout bien recherché pour le bonheur peut aussi avoir un revers (la richesse entraîne des soucis, la gloire apporte des ennemis, l’amour apporte de la souffrance). Donc le bonheur est insaisissable comme objet déterminé. Conséquence morale : Si le bonheur est indéterminé, il ne peut pas servir de fondement à la morale. La morale, pour Kant, doit être fondée non sur la recherche du bonheur (subjectif, empirique, incertain), mais sur le devoir et la raison (loi morale universelle). D’où sa formule : « le bonheur est un idéal non de la raison, mais de l’imagination ». On peut donner des conseils pratiques pour être heureux (prudence), mais pas des préceptes universels (comme on le fait pour la morale).\n \n Schopenhauer – Le bonheur est illusion, la vie est souffrance. Dans Le Monde comme volonté et comme représentation, Schopenhauer affirme que la vie est fondamentalement souffrance, car gouvernée par la Volonté, force aveugle et insatiable. Le bonheur n’est qu’un bref soulagement entre deux manques. La sagesse consiste à se détacher du vouloir, par l’art, la morale, la compassion ou l’ascèse. L’intérêt est de désillusionner la quête du bonheur, pour lui substituer une lucidité tragique et une voie de libération intérieure.\n \n Si l’on vous proposait de vous injecter dans le cerveau une drogue vous procurant un sentiment de plaisir permanent, pendant toute votre vie (quand votre corps deviendra trop vieux, on vous euthanasie, sans souffrance), accepteriez-vous ? Selon Robert Spaemann, le philosophe ayant imaginé cette expérience, nous refuserions. Pourquoi ? Il fait remarquer qu'à la question que voulons-nous au fond ?, la réponse  est : « Nous voulons en effet la réalité. Nous ne voulons pas, si toutefois nous ne sommes ni malades, ni dépendants, une euphorie illusoire, mais un bonheur qui repose sur un contact avec la réalité effective. » Le bonheur ne se confond donc pas avec le plaisir. L'homme désire la joie, laquelle est liée à une activité ayant du sens, c'est-à-dire altruiste.\n \n \n \n \n SOCIETE VS INDIVIDU\n Avec le temps, la réflexion sur le bonheur s’est politisée et socialisée. Le droit au bonheur des Lumières, l’utilitarisme de Bentham et Mill traduis la tentative de mesurer et d’organiser le bien-être collectif, en faisant du bonheur un objectif social et matériel. Mais cette approche révèle ses limites : le bonheur ne dépend pas de conditions extérieures, il est un état subjectif et non un produit ou un événement. L’insatisfaction, le désir croissant et la compétition sociale rendent le bonheur de plus en plus rare et fragile, et sa recherche peut paradoxalement provoquer du malheur.\n \n Pour Mill le bonheur est à penser comme la maximisation du plaisir pour le plus grand nombre.\n Mill, dans L’Utilitarisme, il affirme que le bonheur est le seul critère moral légitime. Il le définit comme plaisir durable, enrichi de qualités intellectuelles, morales et affectives. Le bonheur individuel compte, mais doit être pondéré par l’utilité sociale. L’éducation et la culture permettent d’élever les individus vers des plaisirs supérieurs.\n L’intérêt est de fonder une éthique rationnelle, sociale et démocratique du bonheur, dépassant le pur hédonisme pour viser le bien commun.",
  },
  { x: 400, y: 400, img: "Map/CentredesLubies.png", type: "info", 
    label:"Centre des Lubies",
    contentImg:"Map/CentredesLubies.png",
    contentText:"Les lubies sont les étincelles de l'esprit.\n\nElles naissent du hasard et deviennent des idées." 
  }
];

const PLAYER_SPEED = 600;
const CLICK_RADIUS = 50;
const DETECTION_RADIUS = 60;

/* ========================== */
let state = {
  mapObj: null,
  player: { x: 100, y: 100 },
  keys: {},
  lastTs: null,
  dragging: false
};

/* DOM elements */
const viewport = document.getElementById('viewport');
const mapEl = document.getElementById('map');
const playerEl = document.getElementById('player');
const posEl = document.getElementById('pos');
const mapNameEl = document.getElementById('mapName');
const locLabelEl = document.getElementById('locLabel');
const modal = document.getElementById('modal');
const modalImg = document.getElementById('modalImg');
const modalText = document.getElementById('modalText');

/* Charger une map */
function loadMap(mapIdOrObj){
  const mapObj = (typeof mapIdOrObj === 'string') ? MAPS[mapIdOrObj] : mapIdOrObj;
  if(!mapObj){ console.error("Map introuvable :", mapIdOrObj); return; }

  state.mapObj = mapObj;
  mapEl.style.width = mapObj.width + "px";
  mapEl.style.height = mapObj.height + "px";
  mapEl.style.backgroundImage = `url("${mapObj.bg}")`;
  mapEl.style.backgroundSize = "cover";
  mapEl.style.backgroundPosition = "center center"; // <-- ajout important

  mapNameEl.textContent = mapObj.name || mapObj.id || "";

  // Attendre que l’image soit bien chargée avant de centrer
  const img = new Image();
  img.onload = () => {
    renderMarkers();
    clampPlayer();
    centerOnPlayer();
  };
  img.src = mapObj.bg;
}

/* Initialisation */
function init(){
  loadMap(CURRENT_MAP_ID);
  // Placer le joueur au centre logique de la map
  state.player.x = MAPS[CURRENT_MAP_ID].width / 2;
  state.player.y = MAPS[CURRENT_MAP_ID].height / 2;

  // Centrage après rendu complet
  window.addEventListener("load", () => {
    centerOnPlayer();
    updateHUD();
    requestAnimationFrame(loop);
  });
}

/* Rendu des marqueurs */
function renderMarkers(){
  mapEl.querySelectorAll('.marker').forEach(n => n.remove());
  LOCATIONS.forEach((loc, idx) => {
    const i = document.createElement('img');
    i.src = loc.img;
    i.className = 'marker';
    i.style.left = loc.x + 'px';
    i.style.top = loc.y + 'px';
    i.alt = loc.label || ("loc"+idx);
    i.dataset.idx = idx;
    i.addEventListener('click', (ev) => {
      ev.stopPropagation();
      handleLocationClick(loc);
    });
    i.addEventListener('mouseenter', () => locLabelEl.textContent = loc.label);
    i.addEventListener('mouseleave', () => locLabelEl.textContent = "");
    mapEl.appendChild(i);
  });
}

/* Action selon le type */
function handleLocationClick(loc){
  if(!loc) return;
  switch(loc.type){
    case 'info':
      showModal(loc.contentImg, loc.contentText);
      break;
    case 'map':
      if(MAPS[loc.link]) loadMap(loc.link);
      else if (loc.link.endsWith('.html')) window.location.href = loc.link;
      break;
    default:
      console.warn("Type non géré:", loc.type);
  }
}

/* Affichage du modal */
function showModal(imgSrc, text){
  modal.style.display = 'flex';
  modalImg.src = imgSrc || '';
  modalText.innerHTML = formatText(text || '');
}

/* Masquer le modal */
function hideModal(){
  modal.style.display = 'none';
  modalImg.src = '';
  modalText.textContent = '';
}

/* Formater le texte : \n = <br>, \n\n = <br><br> */
function formatText(str){
  return str
    .replace(/\n\s*\n/g, '<br><br>')
    .replace(/\\n/g, '<br>');
}

/* Centrage sur le joueur */
function centerOnPlayer(){
  const vpW = viewport.clientWidth;
  const vpH = viewport.clientHeight;
  const mapW = mapEl.clientWidth;
  const mapH = mapEl.clientHeight;
  let offsetX = vpW/2 - state.player.x;
  let offsetY = vpH/2 - state.player.y;
  offsetX = Math.min(0, Math.max(vpW - mapW, offsetX));
  offsetY = Math.min(0, Math.max(vpH - mapH, offsetY));
  mapEl.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
  playerEl.style.left = state.player.x + 'px';
  playerEl.style.top = state.player.y + 'px';
}

/* Limiter les coordonnées */
function clampPlayer(){
  if(!state.mapObj) return;
  state.player.x = Math.max(0, Math.min(state.mapObj.width, state.player.x));
  state.player.y = Math.max(0, Math.min(state.mapObj.height, state.player.y));
}

/* Déplacement clavier */
window.addEventListener('keydown', (e)=> state.keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', (e)=> state.keys[e.key.toLowerCase()] = false);

/* Drag */
let dragOffset = {x:0,y:0};
playerEl.addEventListener('pointerdown', (ev)=>{
  ev.preventDefault();
  playerEl.setPointerCapture(ev.pointerId);
  state.dragging = true;
  dragOffset.x = ev.clientX;
  dragOffset.y = ev.clientY;
});
playerEl.addEventListener('pointermove', (ev)=>{
  if(!state.dragging) return;
  const dx = ev.clientX - dragOffset.x;
  const dy = ev.clientY - dragOffset.y;
  state.player.x += dx;
  state.player.y += dy;
  dragOffset.x = ev.clientX;
  dragOffset.y = ev.clientY;
  clampPlayer();
  centerOnPlayer();
  updateHUD();
});
playerEl.addEventListener('pointerup', (ev)=>{
  state.dragging = false;
  try{ playerEl.releasePointerCapture(ev.pointerId);}catch(e){}
});

/* HUD dynamique */
function updateHUD(){
  posEl.textContent = `x:${Math.round(state.player.x)} y:${Math.round(state.player.y)}`;
  let nearest = null, bestDist = Infinity;
  LOCATIONS.forEach(loc => {
    const d = Math.hypot(state.player.x - loc.x, state.player.y - loc.y);
    if (d < bestDist) { bestDist = d; nearest = loc; }
  });
  locLabelEl.textContent = (nearest && bestDist < DETECTION_RADIUS) ? nearest.label : "";
}

/* Boucle principale */
function loop(ts){
  if(!state.lastTs) state.lastTs = ts;
  const dt = (ts - state.lastTs) / 1000;
  state.lastTs = ts;
  let dx = 0, dy = 0;
  if(state.keys['arrowup'] || state.keys['w']) dy -= 1;
  if(state.keys['arrowdown'] || state.keys['s']) dy += 1;
  if(state.keys['arrowleft'] || state.keys['a']) dx -= 1;
  if(state.keys['arrowright'] || state.keys['d']) dx += 1;
  if(dx || dy){
    const len = Math.hypot(dx,dy) || 1;
    state.player.x += (dx/len) * PLAYER_SPEED * dt;
    state.player.y += (dy/len) * PLAYER_SPEED * dt;
    clampPlayer();
    centerOnPlayer();
    updateHUD();
  } else updateHUD();
  requestAnimationFrame(loop);
}

/* Initialisation */
function init(){
  loadMap(CURRENT_MAP_ID);
  // On centre le joueur au milieu de la carte
  state.player.x = state.mapObj.width / 2;
  state.player.y = state.mapObj.height / 2;

  // On attend que la map soit bien rendue avant de centrer
  requestAnimationFrame(() => {
    centerOnPlayer();
    updateHUD();
    requestAnimationFrame(loop);
  });
}

init();
</script>
</body>
</html>
